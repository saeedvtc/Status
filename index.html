<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù…ÙƒÙˆØ« ÙˆØ§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† ØªØ§Ø±ÙŠØ®ÙŠÙ†</title>

<!-- jsPDF Ù„Ø¥Ù†Ø´Ø§Ø¡ PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<!-- Google Font -->
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;600;700&display=swap" rel="stylesheet">

<style>
    body {
        font-family: 'Cairo', sans-serif;
        background: linear-gradient(135deg, #d1f3ff, #ffffff);
        margin: 0;
        padding: 30px;
    }

    h2 {
        text-align: center;
        font-size: 32px;
        margin: 0 0 25px 0;
        color: #004d40;
        font-weight: 700;
    }

    .box {
        background: #ffffff;
        padding: 30px;
        border-radius: 18px;
        box-shadow: 0 10px 25px rgba(0,0,0,0.12);
        margin: 35px auto;
        max-width: 650px;
        transition: transform .2s ease;
    }

    .box:hover {
        transform: scale(1.01);
    }

    label {
        font-size: 22px;
        margin-bottom: 10px;
        display: block;
        font-weight: 600;
        color: #004d40;
    }

    input[type="date"] {
        width: 90%;
        padding: 14px;
        font-size: 20px;
        border: 2px solid #009688;
        border-radius: 10px;
        margin-bottom: 20px;
        transition: 0.3s;
    }

    input[type="date"]:focus {
        border-color: #004d40;
        background: #e0f2f1;
        outline: none;
    }

    button {
        padding: 14px 26px;
        font-size: 20px;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        margin-top: 10px;
        margin-bottom: 10px;
        transition: 0.3s ease;
        font-weight: 600;
    }

    button:hover {
        opacity: 0.85;
        transform: translateY(-2px);
    }

    .btn-main { background: #009688; color: white; }
    .add-btn { background: #0277bd; color: white; }
    .calc-btn { background: #2e7d32; color: white; }
    .pdf-btn { background: #6a1b9a; color: white; }
    .remove-btn { background: #d81b60; color: white; }

    .result, #resultDiff, #totalDays {
        background: #f7ffff;
        padding: 20px;
        border-radius: 14px;
        border: 1px solid #b2dfdb;
        margin-top: 20px;
        font-size: 22px;
        line-height: 36px;
        color: #004d40;
        font-weight: 600;
    }

    .violation { color: #ff1744; font-size: 26px; font-weight: 700; }
    .ok { color: #00c853; font-size: 26px; font-weight: 700; }
    .extra { color: #d50000; font-size: 26px; font-weight: 700; }

    .date-pair {
        background: #ffffff;
        border: 1px solid #b2dfdb;
        border-radius: 14px;
        padding: 20px;
        margin-bottom: 15px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
</style>
</head>
<body>

<!-- ===================== -->
<!--      Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø£ÙˆÙ„      -->
<!-- ===================== -->
<div class="box">
    <h2>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù…ÙƒÙˆØ« Ø®Ø§Ø±Ø¬ Ø§Ù„Ø¯ÙˆÙ„Ø©</h2>

    <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø®Ø±ÙˆØ¬:</label>
    <input type="date" id="exitDate">

    <button class="btn-main" onclick="calculateStay()">Ø§Ø­Ø³Ø¨</button>

    <div class="result" id="stayOutput"></div>
</div>

<!-- ===================== -->
<!--      Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø«Ø§Ù†ÙŠ     -->
<!-- ===================== -->
<div class="box">
    <h2>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† ØªØ§Ø±ÙŠØ®ÙŠÙ† (Ù…ØªØ¹Ø¯Ø¯)</h2>

    <div id="dateContainer"></div>

    <button class="add-btn" onclick="addDatePair()">â• Ø¥Ø¶Ø§ÙØ© ØªØ§Ø±ÙŠØ®ÙŠÙ†</button>
    <button class="calc-btn" onclick="calculateAllDifferences()">ğŸ“Š Ø§Ø­Ø³Ø¨ Ø§Ù„ÙØ±Ù‚</button>
    <button class="pdf-btn" onclick="generatePDF()">ğŸ“„ Ø¥Ù†Ø´Ø§Ø¡ PDF</button>

    <div id="resultDiff"></div>
    <div id="totalDays"></div>
</div>

<script>
/* ============================
      Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù…ÙƒÙˆØ«
============================ */
function calculateStay() {
    let exitDate = new Date(document.getElementById("exitDate").value);

    if (!document.getElementById("exitDate").value) {
        document.getElementById("stayOutput").innerHTML = "âš  Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø®Ø±ÙˆØ¬.";
        return;
    }

    let today = new Date();

    let totalDays = Math.floor((today - exitDate) / (1000 * 60 * 60 * 24));

    let years = today.getFullYear() - exitDate.getFullYear();
    let months = today.getMonth() - exitDate.getMonth();
    let days = today.getDate() - exitDate.getDate();

    if (days < 0) {
        months -= 1;
        let prevMonth = new Date(today.getFullYear(), today.getMonth(), 0);
        days += prevMonth.getDate();
    }

    if (months < 0) {
        years -= 1;
        months += 12;
    }

    let formatted = today.toLocaleDateString('ar-EG');

    let status = totalDays > 179 ? "Ù…Ø®Ø§Ù„Ù" : "ØºÙŠØ± Ù…Ø®Ø§Ù„Ù";
    let statusClass = totalDays > 179 ? "violation" : "ok";
    let extraDays = totalDays > 179 ? totalDays - 179 : 0;

    document.getElementById("stayOutput").innerHTML =
        `ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‚Ø¯ÙˆÙ… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹: ${formatted}<br><br>` +
        `Ø§Ù„Ù…Ø¯Ø©: ${years} Ø³Ù†Ø©ØŒ ${months} Ø´Ù‡Ø±ØŒ ${days} ÙŠÙˆÙ…<br>` +
        `<div class="total-days">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${totalDays} ÙŠÙˆÙ…</div><br>` +
        `Ø§Ù„Ø­Ø§Ù„Ø©: <span class="${statusClass}">${status}</span>` +
        (extraDays > 0 ? `<br>ØªØ¬Ø§ÙˆØ²: <span class="extra">${extraDays} ÙŠÙˆÙ…</span>` : "");
}

/* ============================
     Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† ØªØ§Ø±ÙŠØ®ÙŠÙ†
============================ */
let pairCount = 0;

function addDatePair() {
    pairCount++;
    const div = document.createElement("div");
    div.className = "date-pair";
    div.id = "pair" + pairCount;

    div.innerHTML = `
        <label>Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø£ÙˆÙ„:</label>
        <input type="date" class="date1">

        <label>Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø«Ø§Ù†ÙŠ:</label>
        <input type="date" class="date2">

        <button class="remove-btn" onclick="removeDatePair('pair${pairCount}')">ğŸ—‘ Ø­Ø°Ù Ø§Ù„Ø­Ù‚Ù„</button>
    `;

    document.getElementById("dateContainer").appendChild(div);
}

function removeDatePair(id) {
    document.getElementById(id).remove();
}

function calculateAllDifferences() {
    let pairs = document.querySelectorAll(".date-pair");
    let results = "";
    let total = 0;

    pairs.forEach((pair, i) => {
        const d1 = new Date(pair.querySelector(".date1").value);
        const d2 = new Date(pair.querySelector(".date2").value);

        if (isNaN(d1) || isNaN(d2)) {
            results += `âŒ Ø§Ù„Ø­Ù‚Ù„ ${i+1}: ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®<br>`;
        } else {
            let diff = Math.ceil(Math.abs(d2 - d1) / 86400000) + 1;
            results += `â— Ø§Ù„Ø­Ù‚Ù„ ${i+1}: ${diff} ÙŠÙˆÙ…<br>`;
            total += diff;
        }
    });

    document.getElementById("resultDiff").innerHTML = results;
    document.getElementById("totalDays").innerHTML = `ğŸ“Œ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø£ÙŠØ§Ù…: ${total} ÙŠÙˆÙ…`;
}

function generatePDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    let y = 20;

    doc.setFontSize(18);
    doc.text("ØªÙ‚Ø±ÙŠØ± Ø­Ø³Ø§Ø¨ Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®", 10, y);
    y += 15;

    let pairs = document.querySelectorAll(".date-pair");
    let total = 0;

    pairs.forEach((pair, i) => {
        const d1 = pair.querySelector(".date1").value;
        const d2 = pair.querySelector(".date2").value;

        if (!d1 || !d2) return;

        let diff = Math.ceil(Math.abs(new Date(d2) - new Date(d1)) / 86400000) + 1;
        total += diff;

        doc.setFontSize(14);
        doc.text(`Ø§Ù„Ø­Ù‚Ù„ ${i+1}: ${diff} ÙŠÙˆÙ… (Ù…Ù† ${d1} Ø¥Ù„Ù‰ ${d2})`, 10, y);
        y += 10;
    });

    doc.setFontSize(16);
    y += 10;
    doc.text(`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ÙŠØ§Ù…: ${total} ÙŠÙˆÙ…`, 10, y);

    doc.save("ØªÙ‚Ø±ÙŠØ±_Ø§Ù„Ø§ÙŠØ§Ù….pdf");
}

// Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ Ø­Ù‚Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
addDatePair();
</script>

</body>
</html>